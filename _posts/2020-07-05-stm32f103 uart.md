---
layout: post
title: STM32F103VE UART 통신 
author:     UKC
tags: 전기공부
subtitle: HAL 라이브러리를 이용하여 UART 통신 해보기
category: 전기공부
---

CubeMX를 이용하여 STM32F103VE MCU 기준으로 UART 통신을 해보려고 합니다.

UART 통신은 SoC 칩에서 가장 쉽고 간단하게 주변 장치와 통신할 수 있는 비동기 통신 방식이여서 여러 모듈, 장비와 연동하는데 많이 사용됩니다.

이 포스팅에서는 블루투스 모듈을 UART 통신으로 연동 해보겠습니다.

# CubeMX 세팅

![CubeMX View](/img/2019-07-05/CubeMX_view.png)

CubeMX 에서 설정한 핀맵

그 중 PA9, PA10을 UART 통신에 사용해보록 하겠습니다.

![CubeMX View](/img/2019-07-05/CubeMX_uart_config)

USART1을 Asynchronous 모드로 설정하고 band rate를 9600으로 설정 해주었습니다. (블루투스 모듈의 보율이 9600)

![CubeMX View](/img/2019-07-05/CubeMX_uart_inter)

다음 NVIC 설정에서 글로벌 인터럽트 활성화를 시켜줍니다.

![CubeMX View](/img/2019-07-05/CubeMX_uart_pin)

기본 GPIO 설정이 다음과 같이 설정되어 있는지 확인하면 CubeMX 설정이 완료 되었습니다. 

# 코드 

다음 코드는 UART 통신으로 특정 값을 입력받았을때 LED를 켜고 끄는 간단한 예제입니다.

{% highlight C %}

int main(void)
{
    HAL_Init();

    SystemClock_Config();

    MX_GPIO_Init();
    MX_USART1_UART_Init();

    uint8_t RxBuffer[20];

    while (1)
    {
		HAL_UART_Receive(&huart1,RxBuffer,1,20);

		if (RxBuffer[0]=='A'){
				HAL_GPIO_WritePin(GPIOC, GPIO_PIN_13, GPIO_PIN_SET);			
		}
		
		if (RxBuffer[0]=='B'){
				HAL_GPIO_WritePin(GPIOC, GPIO_PIN_13, GPIO_PIN_RESET);		
		}
    }
}

{% highlight C %}